# Disk Mapper (Android)

Инструмент для анализа памяти Android: показывает, куда уходит место, в древовидном виде (похоже на X-plore/TreeSize).

## Основная идея
Приложение отвечает на вопрос: "Почему занято ~95-100 ГБ, если в обычных папках видно меньше?".

Для этого есть два режима анализа:
- файловое дерево (`Root scan`, `Shizuku`),
- системная разбивка по категориям и приложениям (`Apps`).

## Что умеет сейчас
- `Root scan` для `/storage/emulated/0` (через All files access).
- `Shizuku`-скан `Android/data` и `Android/obb`.
- `Apps`-режим с полной категоризацией из `dumpsys diskstats`:
  - `apps-apk`, `apps-data`, `apps-cache`, `system`, `other`, `photos`, `videos`, `audio`, `free`.
- Детализация по приложениям:
  - `per-app` (общий размер по приложению),
  - `apps-apk-by-app`,
  - `apps-data-by-app`,
  - `apps-cache-by-app`.
- Два размера для каждого узла:
  - `D` - реально занято на диске (allocated/on-disk),
  - `L` - логический размер данных (без кластерного оверхеда).
- Сворачиваемое/раскрываемое дерево.
- Фильтры: `All`, `Telegram`, `Videos`, `Archives`, `Installers`.

## Как пользоваться
1. Запусти приложение.
2. Нажми `Apps` для общей картины "куда уходит место".
3. Смотри блок `categories` как основную несуммирующуюся сводку.
4. Для поиска конкретных виновников раскрой:
   - `per-app` (топ по общему размеру),
   - `apps-data-by-app` (топ по данным),
   - `apps-cache-by-app` (топ по кэшу).
5. Для проверки пользовательских папок нажми `Root scan`.
6. Для `Android/data` и `Android/obb` используй `Shizuku`.

## Важно про математику
- `categories` - базовая сводка used/free.
- `per-app` и `*-by-app` - это другие представления тех же app-байт.
- Их нельзя складывать друг с другом и с `categories`, иначе получится "больше 100%".

## Разрешения и доступы
- `Usage Access` нужен для корректной app-детализации.
- `Shizuku` нужен для полноценного доступа к `Android/data`/`obb`.
- Без Shizuku на части прошивок Android private-папки видны неполно.

## Ограничения
- На некоторых прошивках даже с Shizuku (режим shell/uid 2000) доступ к части private-данных может быть ограничен.
- UI показывает доступные данные и явно пишет долю видимых app-байт (`Apps visible: X / Y`).

## Сборка и запуск из исходников
1. Открой проект в Android Studio.
2. Выполни Gradle sync.
3. Собери и установи debug APK.

## CI / APK
- Workflow: `.github/workflows/android-ci.yml`
- После каждого push в `main` публикуется артефакт `app-debug` в GitHub Actions.
